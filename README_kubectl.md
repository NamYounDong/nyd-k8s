==============================
kubectl í•µì‹¬ ê´€ë¦¬ ëª…ë ¹ì–´ ê°€ì´ë“œ
(Jenkins + Kubernetes ê¸°ì¤€)
==============================

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
2ï¸âƒ£ kubectl describe â€” â€œìƒì„¸ ì •ë³´ + ì´ë²¤íŠ¸â€
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

ìš©ë„
- ë¦¬ì†ŒìŠ¤ê°€ ì™œ ì•ˆ ëœ¨ëŠ”ì§€
- ì™œ ì‹¤íŒ¨í–ˆëŠ”ì§€
- í˜„ì¬ ì–´ë–¤ ìƒíƒœì¸ì§€
ì›ì¸ì„ íŒŒì•…í•  ë•Œ ì‚¬ìš©

ê¸°ë³¸ í˜•ì‹
kubectl describe <resource> <name> -n <namespace>

ì˜ˆì‹œ
kubectl describe pod jenkins-xxxx -n cicd
kubectl describe sa jenkins -n cicd
kubectl describe ingress jenkins-ingress -n cicd

ì—¬ê¸°ì„œ í™•ì¸í•˜ëŠ” í•µì‹¬ ì •ë³´
- Event (ImagePullBackOff, FailedScheduling ë“±)
- ì–´ë–¤ ServiceAccountë¥¼ ì‚¬ìš©í•˜ëŠ”ì§€
- ì–´ë–¤ PVC / Volumeì´ ë¶™ì–´ ìˆëŠ”ì§€
- Node ì–´ë””ì— ìŠ¤ì¼€ì¤„ë§ ë˜ì—ˆëŠ”ì§€

ì‹¤ë¬´ íŒ
- ì¥ì•  ë¶„ì„ ì‹œ getë³´ë‹¤ describeê°€ ë¨¼ì €ë‹¤


â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
3ï¸âƒ£ kubectl apply â€” â€œì„ ì–¸ì  ìƒì„±Â·ìˆ˜ì •â€
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

ìš©ë„
- YAML íŒŒì¼ ê¸°ì¤€ìœ¼ë¡œ
  - ì—†ìœ¼ë©´ ìƒì„±
  - ìˆìœ¼ë©´ ë³€ê²½

ê¸°ë³¸ í˜•ì‹
kubectl apply -f <file.yaml>
kubectl apply -f <directory/>

ì˜ˆì‹œ
kubectl apply -f 00-namespaces.yaml
kubectl apply -f 20-cicd-jenkins.yaml
kubectl apply -f k8s/

ìš´ì˜ íŒ
- íŒŒì¼ ë²ˆí˜¸ ìˆœì„œ = ì ìš© ìˆœì„œ
- applyëŠ” ìš´ì˜ í‘œì¤€
- createëŠ” ì¼íšŒì„± ì‹¤ìŠµìš©ì— ê°€ê¹ë‹¤


â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
4ï¸âƒ£ kubectl delete â€” â€œë¦¬ì†ŒìŠ¤ ì œê±°â€
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

ìš©ë„
- ë¦¬ì†ŒìŠ¤ë¥¼ ëª…ì‹œì ìœ¼ë¡œ ì‚­ì œ

ê¸°ë³¸ í˜•ì‹
kubectl delete <resource> <name> -n <namespace>
kubectl delete -f <file.yaml>

ì˜ˆì‹œ
kubectl delete pod jenkins-xxxx -n cicd
kubectl delete -f 21-cicd-jenkins-ingress.yaml

ì¤‘ìš”
- Deployment ì‚­ì œ â†’ Pod ìë™ ì‚­ì œ
- PVCëŠ” ë³´í†µ ìë™ ì‚­ì œë˜ì§€ ì•ŠìŒ (ë°ì´í„° ë³´í˜¸ ëª©ì )


â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
5ï¸âƒ£ kubectl logs â€” â€œì• í”Œë¦¬ì¼€ì´ì…˜ ë¡œê·¸â€
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

ìš©ë„
- ì»¨í…Œì´ë„ˆ stdout / stderr ë¡œê·¸ í™•ì¸

ê¸°ë³¸ í˜•ì‹
kubectl logs <pod-name> -n <namespace>

ìì£¼ ì“°ëŠ” ì˜µì…˜
kubectl logs -f <pod> -n <ns>        (ì‹¤ì‹œê°„ ë¡œê·¸)
kubectl logs <pod> -c <container>   (ë©€í‹° ì»¨í…Œì´ë„ˆ)

ì˜ˆì‹œ
kubectl logs deploy/jenkins -n cicd
kubectl logs -f jenkins-xxxx -n cicd


â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
6ï¸âƒ£ kubectl exec â€” â€œì»¨í…Œì´ë„ˆ ì•ˆìœ¼ë¡œ ì ‘ì†â€
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

ìš©ë„
- íŒŒì¼ í™•ì¸
- ë””ë²„ê¹…
- ì´ˆê¸° ë¹„ë°€ë²ˆí˜¸ í™•ì¸

ê¸°ë³¸ í˜•ì‹
kubectl exec -it <pod> -n <namespace> -- <command>

ì˜ˆì‹œ
kubectl exec -it deploy/jenkins -n cicd -- bash
kubectl exec -it deploy/jenkins -n cicd -- \
  cat /var/jenkins_home/secrets/initialAdminPassword

ì£¼ì˜
- execëŠ” ìš´ì˜ ì„œë²„ ì ‘ì†ê³¼ ë™ì¼í•œ ìœ„í—˜ë„
- RBAC í†µì œ í•„ìˆ˜


â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
7ï¸âƒ£ Namespace (ns) â€” â€œê³µê°„ ê°œë…â€
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

ì •ì˜
- ë¦¬ì†ŒìŠ¤ë¥¼ ë…¼ë¦¬ì ìœ¼ë¡œ ë¶„ë¦¬í•˜ëŠ” ê°€ìƒ ê³µê°„

ì¡°íšŒ
kubectl get ns

íŠ¹ì • namespace ì¡°íšŒ
kubectl get all -n cicd
kubectl get pod,svc,ing -n infra

ì™œ ì¤‘ìš”í•œê°€
- RBAC ì ìš© ë‹¨ìœ„
- ì„œë¹„ìŠ¤ / í™˜ê²½ / íŒ€ ë¶„ë¦¬
- ì‚¬ê³  ë²”ìœ„ ì œí•œ


â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
8ï¸âƒ£ ServiceAccount (sa) â€” â€œì¿ ë²„ ì•ˆì˜ ê³„ì •â€
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

ì •ì˜
- Podê°€ Kubernetes APIë¥¼ í˜¸ì¶œí•  ë•Œ ì“°ëŠ” ì‹ ë¶„ì¦

ì¡°íšŒ
kubectl get sa -n cicd
kubectl describe sa jenkins -n cicd

ì‹¤ë¬´ í•µì‹¬
- Jenkins / ì•± / ë°°ì¹˜ ì‘ì—…ì€ ê°ê° ë‹¤ë¥¸ SA ì‚¬ìš©
- SA ë‹¨ë…ìœ¼ë¡œëŠ” ê¶Œí•œ ì—†ìŒ
- ë°˜ë“œì‹œ RoleBinding í•„ìš”


â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
9ï¸âƒ£ RBAC â€” Role / RoleBinding í™•ì¸
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

ìš©ë„
- ê¶Œí•œì´ ìˆëŠ”ì§€ ì—†ëŠ”ì§€ í™•ì¸

ì¡°íšŒ
kubectl get role -n cicd
kubectl get rolebinding -n cicd

ì „ì²´ ì¡°íšŒ
kubectl get role,rolebinding -n cicd

ì¤‘ìš” í¬ì¸íŠ¸
- Roleì€ namespace ì „ìš©
- default namespaceì—ì„œ ì•ˆ ë³´ì´ëŠ” ê²ƒì€ ì •ìƒì¼ ìˆ˜ ìˆìŒ


â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ğŸ”Ÿ ê¶Œí•œ ê²€ì¦ â€” kubectl auth can-i
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

ìš©ë„
- ì´ ê³„ì •ì´ ì´ ì‘ì—…ì„ í•  ìˆ˜ ìˆëŠ”ì§€ ì‚¬ì „ ê²€ì¦

ê¸°ë³¸ í˜•ì‹
kubectl auth can-i <verb> <resource> -n <namespace> \
  --as=system:serviceaccount:<ns>:<sa>

ì˜ˆì‹œ
kubectl auth can-i create deployment -n cicd \
  --as=system:serviceaccount:cicd:jenkins

kubectl auth can-i get pods -n cicd \
  --as=system:serviceaccount:cicd:jenkins

ìš´ì˜ì—ì„œ ë§¤ìš° ì¤‘ìš”
- Jenkins ë°°í¬ ì‹¤íŒ¨ ì›ì¸ 1ìˆœìœ„ = RBAC
- ë°°í¬ ì „ì— can-ië¡œ ê²€ì¦í•˜ë©´ ì¥ì• ë¥¼ ë¯¸ë¦¬ ë§‰ì„ ìˆ˜ ìˆìŒ
